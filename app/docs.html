<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentation - AIDriver</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />

    <!-- Bootstrap 5.3 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- GitHub Markdown CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.5.0/github-markdown-dark.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link href="css/style.css?v=2" rel="stylesheet" />
    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
        background-color: #0d1117;
      }

      @media (max-width: 767px) {
        .markdown-body {
          padding: 15px;
        }
      }

      .markdown-body img {
        max-width: 100%;
        height: auto;
      }

      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 300px;
      }

      .doc-nav .nav-link {
        color: rgba(255, 255, 255, 0.85);
      }

      .doc-nav .nav-link:hover {
        color: #fff;
      }

      .doc-nav .nav-link.active {
        color: #fff;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 0.375rem;
      }

      /* GitHub-style callouts/alerts */
      .markdown-body blockquote {
        padding: 0.5rem 1rem;
        margin: 0 0 1rem 0;
        border-left: 0.25rem solid #30363d;
        background-color: #161b22;
      }

      .markdown-body blockquote p:last-child {
        margin-bottom: 0;
      }

      /* Style for [!Important] callouts */
      .markdown-body blockquote:has(strong:first-child) {
        border-left-color: #a371f7;
      }
    </style>
  </head>
  <body class="bg-dark">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <i class="bi bi-robot me-2"></i>AIDriver Simulator
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <!-- Home Link -->
            <li class="nav-item">
              <a class="nav-link" href="index.html">
                <i class="bi bi-house me-1"></i>Simulator
              </a>
            </li>

            <!-- Build Instructions -->
            <li class="nav-item">
              <a
                class="nav-link"
                href="docs.html?doc=Assembly_Instructions"
                id="buildInstructionsLink"
              >
                <i class="bi bi-tools me-1"></i>Build Instructions
              </a>
            </li>

            <!-- Challenges Dropdown -->
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="challengeDocsDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-book me-1"></i>Challenge Docs
              </a>
              <ul class="dropdown-menu" aria-labelledby="challengeDocsDropdown">
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_0">
                    <i class="bi bi-wrench me-2"></i>Challenge 0: Fix the Code
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_1">
                    <i class="bi bi-arrow-up me-2"></i>Challenge 1: Straight
                    Line
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_2">
                    <i class="bi bi-circle me-2"></i>Challenge 2: Drive a Circle
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_3">
                    <i class="bi bi-rulers me-2"></i>Challenge 3: Distance
                    Sensor
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_4">
                    <i class="bi bi-square me-2"></i>Challenge 4: Drive a Square
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_5">
                    <i class="bi bi-exclamation-triangle me-2"></i>Challenge 5:
                    Obstacle Avoidance
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_6">
                    <i class="bi bi-signpost-split me-2"></i>Challenge 6: Maze
                    Navigation
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="docs.html?doc=Challenge_7">
                    <i class="bi bi-controller me-2"></i>Challenge 7: Gamepad
                    Control
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
      <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-lg-3 col-md-4 mb-4">
          <div
            class="card bg-dark border-secondary sticky-top"
            style="top: 1rem"
          >
            <div class="card-header bg-secondary text-white">
              <i class="bi bi-journal-text me-2"></i>Documentation
            </div>
            <div class="card-body">
              <nav class="nav flex-column doc-nav">
                <a
                  class="nav-link"
                  href="docs.html?doc=Assembly_Instructions"
                  data-doc="Assembly_Instructions"
                >
                  <i class="bi bi-tools me-2"></i>Build Instructions
                </a>
                <hr class="my-2 border-secondary" />
                <h6 class="text-muted px-3 mb-2">Challenges</h6>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_0"
                  data-doc="Challenge_0"
                >
                  <i class="bi bi-0-circle me-2"></i>Challenge 0
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_1"
                  data-doc="Challenge_1"
                >
                  <i class="bi bi-1-circle me-2"></i>Challenge 1
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_2"
                  data-doc="Challenge_2"
                >
                  <i class="bi bi-2-circle me-2"></i>Challenge 2
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_3"
                  data-doc="Challenge_3"
                >
                  <i class="bi bi-3-circle me-2"></i>Challenge 3
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_4"
                  data-doc="Challenge_4"
                >
                  <i class="bi bi-4-circle me-2"></i>Challenge 4
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_5"
                  data-doc="Challenge_5"
                >
                  <i class="bi bi-5-circle me-2"></i>Challenge 5
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_6"
                  data-doc="Challenge_6"
                >
                  <i class="bi bi-6-circle me-2"></i>Challenge 6
                </a>
                <a
                  class="nav-link"
                  href="docs.html?doc=Challenge_7"
                  data-doc="Challenge_7"
                >
                  <i class="bi bi-7-circle me-2"></i>Challenge 7
                </a>
                <hr class="my-2 border-secondary" />
                <a
                  class="nav-link"
                  href="docs.html?doc=Common_Errors"
                  data-doc="Common_Errors"
                >
                  <i class="bi bi-bug me-2"></i>Common Errors
                </a>
              </nav>
            </div>
          </div>
        </div>

        <!-- Documentation Content -->
        <div class="col-lg-9 col-md-8">
          <div class="card bg-dark border-secondary">
            <div class="card-body p-0">
              <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <article
                id="markdownContent"
                class="markdown-body"
                style="display: none"
              ></article>
              <div
                id="errorMessage"
                class="alert alert-danger m-4"
                style="display: none"
              >
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span id="errorText">Failed to load documentation.</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- DOMPurify for sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>

    <script>
      // GitHub raw content base URL
      const GITHUB_RAW_BASE =
        "https://raw.githubusercontent.com/TempeHS/AIDriver_MicroPython_Challanges/main/docs/";
      const GITHUB_IMAGES_BASE =
        "https://raw.githubusercontent.com/TempeHS/AIDriver_MicroPython_Challanges/main/docs/images/";

      // Configure marked
      marked.setOptions({
        gfm: true,
        breaks: true,
        headerIds: true,
      });

      // Get the document name from URL parameters
      function getDocFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get("doc") || "Assembly_Instructions";
      }

      // Update active nav link
      function updateActiveNav(docName) {
        document.querySelectorAll(".doc-nav .nav-link").forEach((link) => {
          link.classList.remove("active");
          if (link.dataset.doc === docName) {
            link.classList.add("active");
          }
        });

        // Also update the Build Instructions link in navbar
        const buildLink = document.getElementById("buildInstructionsLink");
        if (docName === "Assembly_Instructions") {
          buildLink.classList.add("active");
        } else {
          buildLink.classList.remove("active");
        }
      }

      // Fix image URLs in markdown to point to GitHub
      function fixImageUrls(html) {
        // Replace relative image paths with GitHub raw URLs
        return html
          .replace(/src="images\//g, `src="${GITHUB_IMAGES_BASE}`)
          .replace(/src="\.\/images\//g, `src="${GITHUB_IMAGES_BASE}`);
      }

      // Load and render markdown
      async function loadMarkdown(docName) {
        const spinner = document.getElementById("loadingSpinner");
        const content = document.getElementById("markdownContent");
        const errorDiv = document.getElementById("errorMessage");
        const errorText = document.getElementById("errorText");

        // Show loading state
        spinner.style.display = "flex";
        content.style.display = "none";
        errorDiv.style.display = "none";

        try {
          const url = `${GITHUB_RAW_BASE}${docName}.md`;
          const response = await fetch(url);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          let markdown = await response.text();

          // Parse markdown to HTML
          let html = marked.parse(markdown);

          // Fix image URLs
          html = fixImageUrls(html);

          // Sanitize HTML
          html = DOMPurify.sanitize(html, {
            ADD_TAGS: ["img"],
            ADD_ATTR: ["src", "alt", "title"],
          });

          // Display content
          content.innerHTML = html;
          content.style.display = "block";
          spinner.style.display = "none";

          // Update page title
          const docTitle = docName.replace(/_/g, " ");
          document.title = `${docTitle} - AIDriver`;

          // Update active nav
          updateActiveNav(docName);
        } catch (error) {
          console.error("Failed to load documentation:", error);
          spinner.style.display = "none";
          errorDiv.style.display = "block";
          errorText.textContent = `Failed to load documentation: ${error.message}`;
        }
      }

      // Handle navigation without page reload (optional enhancement)
      document
        .querySelectorAll(
          '.doc-nav .nav-link, .dropdown-menu .dropdown-item[href^="docs.html"]'
        )
        .forEach((link) => {
          link.addEventListener("click", (e) => {
            const href = link.getAttribute("href");
            if (href && href.startsWith("docs.html?doc=")) {
              e.preventDefault();
              const docName = new URLSearchParams(href.split("?")[1]).get(
                "doc"
              );
              if (docName) {
                window.history.pushState({}, "", href);
                loadMarkdown(docName);
              }
            }
          });
        });

      // Handle browser back/forward
      window.addEventListener("popstate", () => {
        loadMarkdown(getDocFromUrl());
      });

      // Initial load
      document.addEventListener("DOMContentLoaded", () => {
        loadMarkdown(getDocFromUrl());
      });
    </script>
  </body>
</html>
